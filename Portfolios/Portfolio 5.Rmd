---
title: "Portfolio 5, Study Group 10"
author: "Jesper Fischer, Kristian Severin, Lasse Hansen, Lærke Brædder, Sarah Hvid"
date: "3/16/2020"
output:
  html_document: default
  pdf_document: default
---

### 1. Checking input using R

First we will start by inputting the data that we need to compare in the two following assignments.

```{r}
OnsetS1 <- c(3,117,203,278,375,442,513,616,723,807,910,1003,1093,1186,1282)
OnsetS2 <- c(50,157,242,326,414,471,555,670,768,873,944,1054,1149,1242,1316)


DurationsS1 <- c(35,27,27,36,26,16,29,42,33,54,22,38,43,43,21)
DurationS2 <- c(55,33,23,37,16,30,48,40,26,24,46,27,25,27,30)
```

### 1.a. There was a signifiant difference between the durations of the two story types.

To be able to deem if there is a significant difference between the durations of the two story we are going to conduct a t-tests. This will test if there is a significant difference between the two story types:

```{r}
t.test(OnsetS1, OnsetS2)
```

On average, the onsets for story1  (M = 636,733), differed from those for story2 (M = 682.0667). This difference was not significant t(27,99) = −0.306, p = 0.76.

### 1.b. There was a significant difference between the ratings of the two story types.

To test if there is a significant difference between the ratings of the two stories we are again going to conduct a t-test:

```{r}
t.test(DurationsS1, DurationS2)
```

On average, the mean ratings for story1  (M = 32,80) differed marginally from those for story2 (M = 32,47). This difference was not significant t(27,92) = 0,087, p = 0,93.

### 2.a. Make a screenshot and report the design matrix figure generated by SPM. How many columns does it have? What do the different columns represent?

It has 4 columns, one for story 1, one for story 2, one for the ratings and a constant.


![Design Matrix](DesignMatrix11.png)

### 3.a Report periodogram plots of the Frequency domain for the three conditions.

![Periodogram Story1](Periodogram S1.png)

![Periodogram Story2](Periodogram S2.png)
![Periodogram Ratings](Periodogram R.png)

### 3.b.Eye-balling task: What are the most predominant frequencies for the three conditions, as seen from these plots?

The most predominant frequencies for the covariates are measured by finding the highest wave peak of the three periodograms and then manually reporting the highest x-value that belongs with that wave peak:

For story 1: HZ = 0.01
For story 2: HZ = 0.01
For ratings: HZ = 0.02


### 4.a 

It now has 6. For story 1, interaction between story 1 and ratings, story 2, interaction between story2 and ratings, ratings, and a constant. 

Columns 2 and 4 model the rating effects.

![Interaction](DesignMatrixInteraction.png)

### 4.b

It is important to subtract the mean and thereby get the residuals because the covariates then will be orthogonal with the story and we will be able to see the effects of them individually. If you did not mean center the covariates, you would only be able to see positive BOLD responses, and thereby not being able to contrast less activation for more activation.

### 4.c 

![DesignMatrix](DesignMatrix.png)

### 5.a. Report plots of the Frequency domain for the three conditions.

![Frequency Domain Story1](FrequencyDomainS1.png)
![Frequency Domain Story2](FrequencyDomainS2.png)

![Frequency Domain Rating1](FrequencyDomainR1.png)

### 5.a.1 Does the filter seem to affect the covariates? 

The problem with a filter is that it needs to capture the noise in the data and not the actual data we wan't to capture. And from the periodograms of the two stories we see that a part of the covariates are filtered away even though that is what we are interested in.

### 5.b.Eye-balling task: What are the most predominant frequencies for the covariates, as seen from these plots?

The most predominant frequencies for the covariates are measured by finding the highest wave peak of the three periodograms and then manually reporting the highest x-value that belongs with that wave peak:

For story 1: HZ = 0.005 and 0,015
For story 2: HZ = 0.003
For ratings: HZ = 0.02

### 5.c. The high-pass filter consists of low-frequency cosine-waves, which together can model any fluctuation below the specified frequency. Plot and report figures of the high-pass filter using these two lines in MatLab

To be able to plot the high pass filter we will start by loading the filter into Matlab. This is done by typing: load('SPM.mat'). The filter is then plotted with the following two commands:

figure, imagesc(SPM.xX.K.X0)
figure, plot(SPM.xX.K.X0)

![High Pass Image](HighPassF.png)


![High Pass plot](HighPassPlot.png)

### 5.d. How many cosine waves are in this specific high-pass filter?

In this specific high-pass filter there are 21 cosine waves. This is made visually clear from the ammount of different waves in the pictures above.

### 5.e. Make a hypothetical slow wave signal by creating a vector in Matlab (e.g. a=[2,1,4] for a row vector or a=[3;2;4] for a column vector) with the same length as the number of waves as in the high-pass filter. Multiply the vector with the filter (using "*") and plot the result (figure, plot(my_result_vector).

First i will start by making a hypothetical column vector:

a = [2;1;4;5;6;2;2;1;4;4;5;6;7;3;2;1;3;5;5;6;4]

Afterwards we will create a vector b, that is the product of a and the filter:

b = a*'SPM.mat'

Then to plot the result:

figure, plot(b)

The output is as follows:

![Slow wave signal](SlowWaveSignal.png)

### 5.f. Eyeballing the bottomless pit of despair: Explore “design orthogonality” (in the “review” function). Dark colors in the design “orthonogality matrix” (include it in report) indicate that different covariates are correlated. Which covariates are most correlated in the current design?

![Orthogonality matrix](DesignOrthogonality.png)

From the orthogonality matrix, it seems that the covariates that are most correlated are ratings 1 & 6, ratings 2 & 6, ratings 3 & 6, ratings 3 & 4 and ratings 1 & 4.  

### 5.g. Plot and report the hemodynamic response function (HRF) using this call in Matlab (you need to have loaded the SPM.mat file):

This is done by having the 'SPM.mat' file loaded and typing:

figure, plot(SPM.xBF.dt:SPM.xBF.dt:SPM.xBF.length,SPM.xBF.bf)

![Hemodynamic response function](Hemodynamic Response.png)

### 6.a. Inspect the design matrix and see what it does to the model when these are added

In the batch, when running the model, time and dispersion derivatives are added under 'Basis Functions'.

Afterwards we load the SPM.mat file into matlab and type the following code:

figure, plot(SPM.xBF.dt:SPM.xBF.dt:SPM.xBF.length,SPM.xBF.bf)

The HRF with time and dispersion added as derivatives are as follows:

![HRF with derivatives](HRF.png)

### 6.b. Try changing and reporting the values in the contrast matrix below (looking like this: [1,1,1]) and see what it does to the response function.

Then by plotting the three derivates with equally much explenation, done by adding the contrast [1,1,1]. We will see a linear combination of the three gathered into one model:

figure, plot(SPM.xBF.dt:SPM.xBF.dt:SPM.xBF.length,SPM.xBF.bf*[1;1;1])

![HRFContrasts](HRFContr.png)





